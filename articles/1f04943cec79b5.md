---
title: "Terraformã§è¤‡æ•°ç’°å¢ƒã®å…±é€šéƒ¨åˆ†ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã™ã‚‹"
emoji: "ğŸ¥¨"
type: "tech"
topics: ["terraform"]
published: true
---

`production` ã¨ `development` ã®2ç’°å¢ƒã®ãŸã‚ã€VPCã‚’æ§‹ç¯‰ã™ã‚‹ä¾‹ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

```
$ tree
.
â”œâ”€â”€ development
â”‚Â Â  â””â”€â”€ main.tf
â””â”€â”€ production
    â””â”€â”€ main.tf

2 directories, 2 files
```

æ™®é€šã«æ›¸ãã¨ã€ `local.environment` ä»¥å¤–ã€åŒå†…å®¹ã® `main.tf` ãŒ2ã¤ä½œæˆã•ã‚Œã¾ã™ã€‚

```hcl:production/main.tf
locals {
  environment = "production"
}

terraform {
  required_version = "~> 1.1"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 4.0"
    }
  }
}

provider "aws" {
  profile = "example"
  region  = "ap-northeast-1"
}

resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"

  tags = {
    Name = local.environment
  }
}

output "vpc_id" {
  value = aws_vpc.main.id
}
```

```hcl:development/main.tf
locals {
  environment = "development"
}

terraform {
  required_version = "~> 1.1"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 4.0"
    }
  }
}

provider "aws" {
  profile = "example"
  region  = "ap-northeast-1"
}

resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"

  tags = {
    Name = local.environment
  }
}

output "vpc_id" {
  value = aws_vpc.main.id
}
```

ã“ã®ç¨‹åº¦ãªã‚‰ä½•ã¨ã‹ãªã‚Šã¾ã™ãŒã€ç’°å¢ƒã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚„å¤‰æ›´ãŒå¢—ãˆã¦ã„ã£ãŸå ´åˆã€æ‰‹ã«è² ãˆãªããªã£ã¦ã„ãã¾ã™ã€‚

ä¸Šè¨˜ã®ä¾‹ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ãŸå ´åˆã€æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

```
$ tree
.
â”œâ”€â”€ development
â”‚Â Â  â””â”€â”€ main.tf
â”œâ”€â”€ module
â”‚Â Â  â””â”€â”€ main.tf
â””â”€â”€ production
    â””â”€â”€ main.tf

3 directories, 3 files
```

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ãŸå…±é€šéƒ¨åˆ†ã§ã™ã€‚

```hcl:module/main.tf
variable "environment" {
  type = string
}

variable "profile" {
  type    = string
  default = "default"
}

variable "region" {
  type    = string
  default = "ap-northeast-1"
}

terraform {
  required_version = "~> 1.1"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 4.0"
    }
  }
}

provider "aws" {
  profile = var.profile
  region  = var.region
}

resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"

  tags = {
    Name = var.environment
  }
}

output "vpc_id" {
  value = aws_vpc.main.id
}
```

å„ç’°å¢ƒã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

```hcl:production/main.tf
locals {
  environment = "production"
  profile     = "example"
}

module "main" {
  source      = "../module"
  profile     = local.profile
  environment = local.environment
}

output "vpc_id" {
  value = module.main.vpc_id
}
```

```hcl:development/main.tf
locals {
  environment = "development"
  profile     = "example"
}

module "main" {
  source      = "../module"
  profile     = local.profile
  environment = local.environment
}

output "vpc_id" {
  value = module.main.vpc_id
}
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯å…ƒã€…ã®ãƒªã‚½ãƒ¼ã‚¹å®šç¾©ãŒçŸ­ã„ãŸã‚ã€ä¸€è¦‹ã—ãŸã¨ã“ã‚è¨˜è¿°é‡ãŒæ¸›ã£ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚å„ç’°å¢ƒã® `main.tf` ã«æ³¨ç›®ã™ã‚‹ã¨ã€åŠåˆ†ä»¥ä¸‹ã«æ¸›ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«éƒ¨åˆ†ãŒé•·ããªã£ã¦ã„ã¾ã™ã€‚

é€šå¸¸ã€ç’°å¢ƒã”ã¨ã®å·®åˆ†ã‚ˆã‚Šå…±é€šéƒ¨åˆ†ã®æ–¹ãŒã‹ãªã‚Šå¤§ãããªã‚Šã¾ã™ã®ã§ã€ç°¡æ½”æ€§ã¨ä¿å®ˆæ€§ã¯å¢—ã—ã¦ã„ãã¨æ€ã„ã¾ã™ã€‚
